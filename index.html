<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Corte & Estilo - Agendamento Online</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <!-- SweetAlert2 CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <style>
      :root {
        --primary: #1a1a1a;
        --secondary: #d4af37;
        --light: #f8f9fa;
        --dark: #343a40;
        --accent: #2c2c2c;
      }
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f5f5f5;
        color: var(--primary);
        background-image: url("https://images.unsplash.com/photo-1595476108010-b4d1f102b1b1?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80");
        background-size: cover;
        background-attachment: fixed;
        background-position: center;
        position: relative;
        margin: 0;
      }
      body::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.85);
        z-index: -1;
      }
      .navbar {
        background-color: rgba(26, 26, 26, 0.95) !important;
        border-bottom: 2px solid var(--secondary);
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        padding: 15px 0;
      }
      .navbar-brand {
        font-weight: 700;
        color: var(--secondary) !important;
        font-size: 2rem;
        display: flex;
        align-items: center;
      }
      .navbar-brand i {
        margin-right: 10px;
        font-size: 1.5rem;
      }
      .nav-link {
        color: var(--light) !important;
        font-weight: 500;
        margin: 0 15px;
        padding: 10px 20px;
        border-radius: 25px;
        transition: all 0.3s ease;
      }
      .nav-link:hover,
      .nav-link.active {
        color: var(--secondary) !important;
        background-color: rgba(212, 175, 55, 0.2);
      }
      .hero {
        padding: 120px 0;
        color: white;
        text-align: center;
      }
      .hero h1 {
        font-size: 4rem;
        font-weight: 800;
        margin-bottom: 25px;
        color: var(--secondary);
        text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
      }
      .hero p {
        font-size: 1.3rem;
        max-width: 750px;
        margin: 0 auto 40px;
        opacity: 0.9;
      }
      .btn-gold {
        background-color: var(--secondary);
        color: var(--primary);
        font-weight: 600;
        padding: 12px 30px;
        border-radius: 50px;
        transition: all 0.3s ease;
        border: none;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .btn-gold:hover {
        background-color: #c9a227;
        transform: translateY(-5px);
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
      }
      .section {
        padding: 100px 0;
        background-color: rgba(26, 26, 26, 0.92);
        margin: 60px 0;
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        color: white;
      }
      .section-title {
        text-align: center;
        margin-bottom: 60px;
        color: var(--secondary);
        font-size: 2.5rem;
        font-weight: 700;
        position: relative;
      }
      .section-title::after {
        content: "";
        display: block;
        width: 120px;
        height: 4px;
        background-color: var(--secondary);
        margin: 20px auto 0;
        border-radius: 2px;
      }
      .price-card {
        background-color: rgba(255, 255, 255, 0.12);
        border-radius: 15px;
        padding: 35px;
        margin-bottom: 30px;
        transition: all 0.3s ease;
        border: 1px solid rgba(212, 175, 55, 0.3);
      }
      .price-card:hover {
        transform: translateY(-12px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        border-color: var(--secondary);
      }
      .price-card h3 {
        color: var(--secondary);
        font-weight: 700;
        font-size: 1.8rem;
      }
      .price {
        font-size: 2.8rem;
        font-weight: 700;
        color: white;
        margin: 25px 0;
      }
      .chatbot-container {
        background-color: rgba(26, 26, 26, 0.95);
        padding: 40px;
        border-radius: 15px;
        border: 1MERDApx solid var(--secondary);
        max-width: 700px;
        margin: 0 auto;
      }
      .chatbot-messages {
        height: 400px;
        overflow-y: auto;
        margin-bottom: 20px;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
      }
      .chatbot-message {
        margin-bottom: 15px;
        padding: 10px 15px;
        border-radius: 10px;
      }
      .chatbot-message.bot {
        background-color: rgba(212, 175, 55, 0.2);
        color: white;
      }
      .chatbot-message.user {
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
        text-align: right;
      }
      .chatbot-input {
        display: flex;
        gap: 10px;
      }
      .chatbot-input input {
        flex: 1;
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 12px;
        border-radius: 25px;
      }
      .chatbot-input input:focus {
        background-color: rgba(255, 255, 255, 0.2);
        border-color: var(--secondary);
        outline: none;
      }
      .horarios-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 20px;
      }
      .horario-btn {
        padding: 10px;
        border: 1px solid var(--secondary);
        background: rgba(212, 175, 55, 0.1);
        color: white;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
      }
      .horario-btn:hover {
        background: rgba(212, 175, 55, 0.3);
      }
      .horario-btn.reservado {
        background: rgba(255, 0, 0, 0.2);
        border-color: #ff0000;
        cursor: not-allowed;
      }
      footer {
        background-color: var(--primary);
        color: white;
        padding: 40px 0;
        text-align: center;
      }
      .social-icons a {
        color: white;
        font-size: 1.8rem;
        margin: 0 15px;
        transition: all 0.3s ease;
      }
      .social-icons a:hover {
        color: var(--secondary);
        transform: translateY(-7px);
      }
      .service-item {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        transition: all 0.3s ease;
      }
      .service-item:hover {
        background-color: rgba(212, 175, 55, 0.15);
        transform: translateX(15px);
      }
      .service-icon {
        font-size: 1.8rem;
        color: var(--secondary);
        margin-right: 20px;
        width: 50px;
        text-align: center;
      }
      @media (max-width: 768px) {
        .chatbot-container {
          padding: 15px !important;
          margin: 0 10px;
        }
        .chatbot-messages {
          height: 300px !important;
          padding: 10px !important;
          font-size: 0.9rem;
        }
        .chatbot-message {
          padding: 8px 12px !important;
          margin-bottom: 10px !important;
          font-size: 0.9rem;
        }
        .chatbot-input {
          flex-direction: row;
          gap: 8px;
        }
        .chatbot-input input {
          width: 100% !important;
          padding: 8px 12px !important;
        }
        .chatbot-input button {
          width: auto;
          padding: 8px 15px !important;
          font-size: 0.85rem;
          white-space: nowrap;
        }
        .horarios-container {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (max-width: 480px) {
        .chatbot-input button {
          padding: 8px 12px !important;
        }
        .horarios-container {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand" href="#home">
          <i class="fas fa-cut"></i> Corte & Estilo
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link active" href="#home">Início</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#services">Serviços</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#pricing">Preços</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#booking">Agendamento</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="login.html">Admin</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero">
      <div class="container">
        <h1>Transforme seu Estilo</h1>
        <p class="lead">
          Descubra a melhor experiência em cortes e cuidados masculinos. Agende
          agora e sinta a diferença!
        </p>
        <a href="#booking" class="btn btn-gold btn-lg">Agendar Horário</a>
      </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="section">
      <div class="container">
        <h2 class="section-title">Nossos Serviços</h2>
        <div class="row">
          <div class="col-md-6">
            <div class="service-item">
              <div class="service-icon"><i class="fas fa-cut"></i></div>
              <div>
                <h4>Corte de Cabelo</h4>
                <p>
                  Estilos modernos e personalizados para realçar sua
                  personalidade.
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="service-item">
              <div class="service-icon">
                <i class="fas fa-air-freshener"></i>
              </div>
              <div>
                <h4>Barba</h4>
                <p>
                  Modelagem precisa com produtos premium para um visual
                  impecável.
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="service-item">
              <div class="service-icon"><i class="fas fa-spa"></i></div>
              <div>
                <h4>Hidratação</h4>
                <p>
                  Cuidados especiais para cabelo e barba com resultados
                  duradouros.
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="service-item">
              <div class="service-icon"><i class="fas fa-magic"></i></div>
              <div>
                <h4>Pigmentação</h4>
                <p>
                  Técnica natural para disfarçar fios brancos com perfeição.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Pricing Section -->
    <section id="pricing" class="section">
      <div class="container">
        <h2 class="section-title">Tabela de Preços</h2>
        <div class="row">
          <div class="col-md-4">
            <div class="price-card">
              <h3>Corte Básico</h3>
              <div class="price">R$ 40</div>
              <ul class="list-unstyled">
                <li>
                  <i class="fas fa-check text-success me-2"></i> Corte com
                  tesoura
                </li>
                <li>
                  <i class="fas fa-check text-success me-2"></i> Estilo
                  personalizado
                </li>
                <li>
                  <i class="fas fa-check text-success me-2"></i> Aparada nas
                  laterais
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-4">
            <div class="price-card">
              <h3>Corte Premium</h3>
              <div class="price">R$ 60</div>
              <ul class="list-unstyled">
                <li>
                  <i class="fas fa-check text-success me-2"></i> Corte com
                  tesoura e máquina
                </li>
                <li>
                  <i class="fas fa-check text-success me-2"></i> Degradê ou
                  undercut
                </li>
                <li>
                  <i class="fas fa-check text-success me-2"></i> Lavagem
                  incluída
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-4">
            <div class hotline="price-card">
              <h3>Barba Completa</h3>
              <div class="price">R$ 35</div>
              <ul class="list-unstyled">
                <li>
                  <i class="fas fa-check text-success me-2"></i> Aparar e
                  modelar
                </li>
                <li>
                  <i class="fas fa-check text-success me-2"></i> Aplicação de
                  óleo
                </li>
                <li>
                  <i class="fas fa-check text-success me-2"></i> Hidratação
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-4">
            <div class="price-card">
              <h3>Combo Corte + Barba</h3>
              <div class="price">R$ 80</div>
              <ul class="list-unstyled">
                <li>
                  <i class="fas fa-check text-success me-2"></i> Corte Premium
                </li>
                <li>
                  <i class="fas fa-check text-success me-2"></i> Barba Completa
                </li>
                <li>
                  <i class="fas fa-check text-success me-2"></i> Brinde especial
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-4">
            <div class="price-card">
              <h3>Hidratação</h3>
              <div class="price">R$ 25</div>
              <ul class="list-unstyled">
                <li>
                  <i class="fas fa-check text-success me-2"></i> Tratamento
                  capilar
                </li>
                <li>
                  <i class="fas fa-check text-success me-2"></i> Produtos
                  premium
                </li>
                <li>
                  <i class="fas fa-check text-success me-2"></i> Massagem
                  relaxante
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-4">
            <div class="price-card">
              <h3>Pigmentação</h3>
              <div class="price">R$ 50</div>
              <ul class="list-unstyled">
                <li>
                  <i class="fas fa-check text-success me-2"></i> Disfarce de
                  fios brancos
                </li>
                <li>
                  <i class="fas fa-check text-success me-2"></i> Produtos
                  naturais
                </li>
                <li>
                  <i class="fas fa-check text-success me-2"></i> Duração de 4
                  semanas
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Chatbot Booking Section -->
    <section id="booking" class="section">
      <div class="container">
        <h2 class="section-title">Agendamento Online</h2>
        <div class="chatbot-container">
          <div class="chatbot-messages" id="chatbotMessages"></div>
          <div class="chatbot-input">
            <input
              type="text"
              id="chatbotInput"
              placeholder="Digite sua resposta..."
            />
            <button class="btn btn-gold" onclick="sendMessage()">Enviar</button>
          </div>
          <div class="text-center mt-3">
            <button class="btn btn-secondary" onclick="resetChatbot()">Reiniciar Chatbot</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Modal de Horários -->
    <div class="modal fade" id="horariosModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark">
          <div class="modal-header border-secondary">
            <h5 class="modal-title text-white">
              Horários disponíveis para <span id="modalDate"></span>
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="horarios-container" id="horariosContainer">
              <!-- Horários serão gerados dinamicamente -->
            </div>
          </div>
          <div class="modal-footer border-secondary">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Fechar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="social-icons mb-4">
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-facebook"></i></a>
          <a href="#"><i class="fab fa-whatsapp"></i></a>
        </div>
        <p>© 2025 Corte & Estilo - Todos os direitos reservados</p>
        <p class="mt-3">
          <i class="fas fa-map-marker-alt me-2"></i> Rua do Corte, 123 - Centro,
          Sua Cidade
          <br />
          <i class="fas fa-phone me-2"></i> (00) 1234-5678
        </p>
      </div>
    </footer>

    <!-- Scripts -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      // Base URL para a API (substitua pela URL do backend no Render, se diferente)
      const API_URL = window.location.origin; // Ex.: "https://sua-api.onrender.com"

      // Elementos do DOM
      let chatbotMessages, chatbotInput, horariosModal, horariosContainer, modalDate;

      // Estado do agendamento
      let currentStep = 0;
      let bookingData = {};
      let selectedDate = "";

      // Horários disponíveis
      const horariosDisponiveis = [
        "08:00", "08:30", "09:00", "09:30", "10:00", "10:30", "11:00", "11:30",
        "13:00", "13:30", "14:00", "14:30", "15:00", "15:30", "16:00", "16:30", "17:00", "17:30"
      ];

      // Passos do chatbot
      const steps = [
        {
          message: "Olá! Bem-vindo ao agendamento da Corte & Estilo. O que deseja fazer? (Digite o número)\n1. Novo Agendamento\n2. Cancelar Agendamento\n3. Remarcar Agendamento",
          field: "acao",
          options: { 1: "Novo Agendamento", 2: "Cancelar Agendamento", 3: "Remarcar Agendamento" },
        },
        {
          message: "Para remarcar seu agendamento, você precisará cancelar seu corte e agendar um novamente, clique em reiniciar o Chatbot.",
          field: "remarcarInfo",
          condition: (data) => data.acao === "Remarcar Agendamento",
          action: () => {
            setTimeout(() => {
              currentStep = 1; // Volta para o passo de cancelamento
              bookingData.acao = "Cancelar Agendamento"; // Define a ação como cancelamento
              addMessage(steps[currentStep].message);
            }, 2000);
          },
        },
        {
          message: "Digite o número de WhatsApp do agendamento que deseja cancelar (Ex: 11999999999):",
          field: "telefone",
          condition: (data) => data.acao === "Cancelar Agendamento",
        },
        {
          message: "Qual é o seu nome completo?",
          field: "nome",
          condition: (data) => data.acao === "Novo Agendamento",
        },
        {
          message: "Qual é o seu número de WhatsApp? (Ex: 11999999999)",
          field: "telefone",
          condition: (data) => data.acao === "Novo Agendamento",
        },
        {
          message:
            "Qual serviço você deseja agendar? (Digite o número)\n1. Corte Básico (R$40)\n2. Corte Premium (R$60)\n3. Barba Completa (R$35)\n4. Combo Corte + Barba (R$80)\n5. Hidratação (R$25)\n6. Pigmentação (R$50)",
          field: "servico",
          options: {
            1: "Corte Básico", 2: "Corte Premium", 3: "Barba Completa",
            4: "Combo Corte + Barba", 5: "Hidratação", 6: "Pigmentação",
          },
          condition: (data) => data.acao === "Novo Agendamento",
        },
        {
          message: "Qual barbeiro você prefere? (Digite o número)\n1. Marcos\n2. Ricardo\n3. Carlos\n4. Qualquer um",
          field: "barbeiro",
          options: { 1: "Marcos", 2: "Ricardo", 3: "Carlos", 4: "Qualquer um" },
          condition: (data) => data.acao === "Novo Agendamento",
        },
        {
          message: "Por favor, selecione uma data para o agendamento (clique no campo abaixo):",
          field: "data",
          isDate: true,
          condition: (data) => data.acao === "Novo Agendamento",
        },
        {
          message: "Por favor, selecione um horário disponível:",
          field: "horario",
          isTime: true,
          condition: (data) => data.acao === "Novo Agendamento",
        },
        {
          message: "Alguma observação adicional? (Digite 'nenhuma' se não houver)",
          field: "observacoes",
          condition: (data) => data.acao === "Novo Agendamento",
        },
      ];

      // Inicialização
      document.addEventListener("DOMContentLoaded", () => {
        console.log("DOM carregado, inicializando elementos...");
        chatbotMessages = document.getElementById("chatbotMessages");
        chatbotInput = document.getElementById("chatbotInput");
        horariosContainer = document.getElementById("horariosContainer");
        modalDate = document.getElementById("modalDate");

        // Verificar elementos do DOM
        if (!chatbotMessages || !chatbotInput || !horariosContainer || !modalDate) {
          console.error("Um ou mais elementos do DOM não foram encontrados:", {
            chatbotMessages, chatbotInput, horariosContainer, modalDate
          });
          alert("Erro: Elementos do chatbot não encontrados. Tente recarregar a página.");
          return;
        }

        // Verificar Bootstrap
        if (typeof bootstrap === "undefined") {
          console.error("Bootstrap não está carregado.");
          alert("Erro ao carregar a página. Verifique sua conexão ou tente novamente.");
          return;
        }

        // Inicializar modal
        try {
          horariosModal = new bootstrap.Modal(document.getElementById("horariosModal"), {
            backdrop: "static",
            keyboard: false,
          });
          console.log("Modal inicializado com sucesso:", horariosModal);
        } catch (error) {
          console.error("Erro ao inicializar o modal Bootstrap:", error);
          alert("Erro ao carregar a página. Verifique sua conexão ou tente novamente.");
          return;
        }

        // Adicionar evento de keypress ao chatbotInput
        try {
          chatbotInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") sendMessage();
          });
          console.log("Evento keypress adicionado ao chatbotInput");
        } catch (error) {
          console.error("Erro ao adicionar evento keypress:", error);
        }

        // Iniciar chatbot
        addMessage(steps[0].message);
      });

      // Adicionar mensagem ao chat
      function addMessage(message, type = "bot") {
        console.log("Adicionando mensagem:", message, "Tipo:", type);
        const msgDiv = document.createElement("div");
        msgDiv.className = `chatbot-message ${type}`;

        if (type === "bot" && steps[currentStep]?.isDate) {
          msgDiv.innerHTML = `${message}<br><br>
            <input type="text" id="datePicker" class="form-control" placeholder="Selecione uma data" readonly>`;
          chatbotMessages.appendChild(msgDiv);
          chatbotMessages.scrollTop = chatbotMessages.scrollHeight;

          try {
            flatpickr("#datePicker", {
              locale: "pt",
              minDate: "today",
              dateFormat: "d/m/Y",
              onChange: function (selectedDates, dateStr) {
                console.log("Data selecionada:", dateStr);
                selectedDate = dateStr;
                bookingData.data = dateStr;
                currentStep++;
                showTimeSelection(dateStr);
              },
            });
          } catch (error) {
            console.error("Erro ao inicializar Flatpickr:", error);
            addMessage("Erro ao carregar o seletor de data. Tente novamente.");
          }
        } else {
          msgDiv.textContent = message;
          chatbotMessages.appendChild(msgDiv);
          chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }
      }

      // Mostrar seleção de horários
      async function showTimeSelection(date) {
        console.log("Iniciando showTimeSelection para data:", date);
        try {
          modalDate.textContent = date;
          horariosContainer.innerHTML = "";
          console.log("Limpando horariosContainer e definindo modalDate");

          let reservados = [];
          try {
            console.log("Chamando getAgendamentosPorData...");
            reservados = await getAgendamentosPorData(formatDateForAPI(date));
            console.log("Agendamentos recebidos:", reservados);
          } catch (apiError) {
            console.error("Erro ao consultar API:", apiError);
            addMessage("Erro ao carregar horários. Tente novamente.");
            return;
          }

          horariosDisponiveis.forEach((horario) => {
            const btn = document.createElement("button");
            btn.className = "horario-btn";
            btn.textContent = horario;

            const estaReservado = reservados.some((ag) => ag.horario === horario);
            if (estaReservado) {
              btn.classList.add("reservado");
              btn.disabled = true;
              btn.title = "Horário já reservado";
            } else {
              btn.addEventListener("click", () => {
                bookingData.horario = horario;
                addMessage(`Horário selecionado: ${horario}`);
                try {
                  horariosModal.hide();
                  console.log("Modal fechado após selecionar horário:", horario);
                } catch (error) {
                  console.error("Erro ao fechar modal:", error);
                }
                currentStep++;
                if (currentStep < steps.length && steps[currentStep].condition(bookingData)) {
                  addMessage(steps[currentStep].message);
                }
              });
            }

            horariosContainer.appendChild(btn);
          });

          try {
            console.log("Tentando abrir modal...");
            horariosModal.show();
            console.log("Modal aberto com sucesso");
          } catch (error) {
            console.error("Erro ao abrir modal:", error);
            addMessage("Erro ao abrir a seleção de horários. Tente novamente.");
          }
        } catch (error) {
          console.error("Erro em showTimeSelection:", error);
          addMessage("Erro ao carregar horários. Verifique sua conexão e tente novamente.");
        }
      }

      // Enviar mensagem do usuário
      async function sendMessage() {
        const userInput = chatbotInput.value.trim();
        if (!userInput) return;

        console.log("Enviando mensagem do usuário:", userInput);
        addMessage(userInput, "user");
        chatbotInput.value = "";

        if (currentStep >= steps.length) return;

        const step = steps[currentStep];

        // Validar e armazenar a entrada do usuário
        if (step.options && step.options[userInput]) {
          bookingData[step.field] = step.options[userInput];
        } else {
          bookingData[step.field] = userInput;
        }

        // Executa ação personalizada do passo, se houver (usado para "Remarcar")
        if (step.action) {
          step.action();
          return;
        }

        // Lógica para cancelamento
        if (bookingData.acao === "Cancelar Agendamento" && step.field === "telefone") {
          try {
            const agendamento = await getAgendamentoPorTelefone(userInput);
            if (agendamento) {
              addMessage(`Agendamento encontrado: ${agendamento.nome} (${agendamento.telefone}). Cancelando...`);
              const success = await deleteAgendamentoPorTelefone(userInput);
              if (success) {
                // Exibir alerta de cancelamento com SweetAlert2
                Swal.fire({
                  title: "Agendamento Cancelado!",
                  html: `
                    <p>O agendamento para o número <strong>${userInput}</strong> foi cancelado com sucesso.</p>
                    <p>Se precisar de um novo agendamento, reinicie o chatbot.</p>
                  `,
                  icon: "success",
                  confirmButtonText: "Ok",
                  confirmButtonColor: "#d4af37",
                  background: "#1a1a1a",
                  color: "#f8f9fa",
                });
                setTimeout(() => {
                  resetChatbot();
                }, 3000);
              } else {
                addMessage("Erro ao cancelar. Verifique sua conexão e tente novamente.");
                Swal.fire({
                  title: "Erro ao Cancelar",
                  text: "Não foi possível cancelar o agendamento. Tente novamente.",
                  icon: "error",
                  confirmButtonText: "Ok",
                  confirmButtonColor: "#d4af37",
                  background: "#1a1a1a",
                  color: "#f8f9fa",
                });
                resetChatbot();
              }
            } else {
              addMessage("Nenhum agendamento encontrado com esse número. Tente novamente.");
              currentStep--;
              return;
            }
          } catch (error) {
            console.error("Erro ao processar cancelamento:", error);
            addMessage("Erro de conexão ao cancelar agendamento. Tente novamente.");
            Swal.fire({
              title: "Erro de Conexão",
              text: "Não foi possível conectar ao servidor. Verifique sua conexão e tente novamente.",
              icon: "error",
              confirmButtonText: "Ok",
              confirmButtonColor: "#d4af37",
              background: "#1a1a1a",
              color: "#f8f9fa",
            });
            resetChatbot();
          }
        } else {
          // Avançar para o próximo passo apenas se a condição do próximo passo for válida
          currentStep++;
          while (
            currentStep < steps.length &&
            steps[currentStep] &&
            !steps[currentStep].condition(bookingData)
          ) {
            currentStep++;
          }
        }

        // Exibir a próxima mensagem, se houver
        if (
          currentStep < steps.length &&
          steps[currentStep] &&
          steps[currentStep].condition(bookingData)
        ) {
          setTimeout(() => addMessage(steps[currentStep].message), 500);
        }

        // Salvar agendamento se for o último passo do "Novo Agendamento"
        if (
          bookingData.acao === "Novo Agendamento" &&
          step.field === "observacoes"
        ) {
          await saveAgendamento();
        }
      }

      // Formatar data para a API (DD/MM/YYYY → YYYY-MM-DD)
      function formatDateForAPI(dateStr) {
        console.log("Formatando data:", dateStr);
        const [day, month, year] = dateStr.split("/");
        return `${year}-${month.padStart(2, "0")}-${day.padStart(2, "0")}`;
      }

      // Salvar agendamento
      async function saveAgendamento() {
        try {
          bookingData.data = formatDateForAPI(bookingData.data);
          console.log("Salvando agendamento:", bookingData);

          const response = await fetch(`${API_URL}/api/agendamentos`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(bookingData),
          });
          const result = await response.json();

          if (result.success) {
            addMessage("Agendamento realizado com sucesso! Entraremos em contato para confirmar.");
            // Mostrar alerta bonito com SweetAlert2
            Swal.fire({
              title: "Agendamento Confirmado!",
              html: `
                <p>Olá, <strong>${bookingData.nome}</strong>!</p>
                <p>Seu agendamento foi realizado com sucesso:</p>
                <ul style="text-align: left; margin: 0 auto; max-width: 300px;">
                  <li><strong>Serviço:</strong> ${bookingData.servico}</li>
                  <li><strong>Barbeiro:</strong> ${bookingData.barbeiro}</li>
                  <li><strong>Data:</strong> ${bookingData.data}</li>
                  <li><strong>Horário:</strong> ${bookingData.horario}</li>
                </ul>
                <p>Entraremos em contato via WhatsApp (${bookingData.telefone}) para confirmar.</p>
              `,
              icon: "success",
              confirmButtonText: "Ok",
              confirmButtonColor: "#d4af37",
              background: "#1a1a1a",
              color: "#f8f9fa",
            });
          } else {
            addMessage(`Erro ao agendar: ${result.message || "Tente novamente."}`);
            Swal.fire({
              title: "Erro ao Agendar",
              text: result.message || "Ocorreu um erro ao realizar seu agendamento. Tente novamente.",
              icon: "error",
              confirmButtonText: "Ok",
              confirmButtonColor: "#d4af37",
              background: "#1a1a1a",
              color: "#f8f9fa",
            });
          }

          resetChatbot();
        } catch (error) {
          console.error("Erro ao salvar agendamento:", error);
          addMessage("Erro de conexão com o servidor. Tente novamente mais tarde.");
          Swal.fire({
            title: "Erro de Conexão",
            text: "Não foi possível conectar ao servidor. Verifique sua conexão e tente novamente.",
            icon: "error",
            confirmButtonText: "Ok",
            confirmButtonColor: "#d4af37",
            background: "#1a1a1a",
            color: "#f8f9fa",
          });
        }
      }

      // Obter agendamento por telefone
      async function getAgendamentoPorTelefone(telefone) {
        try {
          console.log("Buscando agendamento para telefone:", telefone);
          const response = await fetch(`${API_URL}/api/agendamentos/telefone/${telefone}`);
          const result = await response.json();
          return result.success ? result.data : null;
        } catch (error) {
          console.error("Erro ao obter agendamento:", error);
          addMessage("Erro de conexão ao buscar agendamento. Tente novamente.");
          return null;
        }
      }

      // Deletar agendamento por telefone
      async function deleteAgendamentoPorTelefone(telefone) {
        try {
          console.log("Cancelando agendamento para telefone:", telefone);
          const response = await fetch(`${API_URL}/api/agendamentos/telefone/${telefone}`, {
            method: "DELETE",
          });
          const result = await response.json();
          return result.success;
        } catch (error) {
          console.error("Erro ao deletar:", error);
          addMessage("Erro de conexão ao cancelar agendamento. Tente novamente.");
          return false;
        }
      }

      // Obter agendamentos por data
      async function getAgendamentosPorData(data) {
        try {
          console.log("Buscando agendamentos para data:", data);
          const response = await fetch(`${API_URL}/api/agendamentos?data=${data}`);
          const result = await response.json();
          return result.success ? result.data : [];
        } catch (error) {
          console.error("Erro ao obter agendamentos:", error);
          addMessage("Erro de conexão ao carregar horários. Tente novamente.");
          return [];
        }
      }

      // Resetar chatbot
      function resetChatbot() {
        console.log("Resetando chatbot...");
        currentStep = 0;
        bookingData = {};
        chatbotMessages.innerHTML = "";
        setTimeout(() => addMessage(steps[0].message), 1000);
      }
    </script>
  </body>
</html>